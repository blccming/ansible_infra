{
	email example@example.com
	acme_dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	order wake_on_lan before respond
}

cloud.{{ domain_public }} {
	reverse_proxy 192.168.178.24:8080
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:8080 {
				lb_try_duration 120s
			}
		}
	}
}

crg.{{ domain_public }} {
	reverse_proxy 192.168.178.24:5100
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:5100 {
				lb_try_duration 120s
			}
		}
	}
}

# local

dd.{{ domain_local }} {
	reverse_proxy 192.168.178.24:3001 # TEMP
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:3001 {
				# TEMP
				lb_try_duration 120s
			}
		}
	}
}

fin.{{ domain_local }} {
	reverse_proxy 192.168.178.24:8096
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:8096 {
				lb_try_duration 120s
			}
		}
	}
}

sync.{{ domain_local }} {
	reverse_proxy 192.168.178.24:8384
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:8384 {
				lb_try_duration 120s
			}
		}
	}
}

trans.{{ domain_local }} {
	reverse_proxy 192.168.178.24:9091
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:9091 {
				lb_try_duration 120s
			}
		}
	}
}

srr.{{ domain_local }} {
	reverse_proxy 192.168.178.24:9130
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:9130 {
				lb_try_duration 120s
			}
		}
	}
}

rrr.{{ domain_local }} {
	reverse_proxy 192.168.178.24:9140
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:9140 {
				lb_try_duration 120s
			}
		}
	}
}

prr.{{ domain_local }} {
	reverse_proxy 192.168.178.24:9696
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:9696 {
				lb_try_duration 120s
			}
		}
	}
}

piped.{{ domain_local }}, pipedapi.{{ domain_local }}, pipedproxy.{{ domain_local }} {
	uri replace "&ump=1" ""
	reverse_proxy 192.168.178.24:8081
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
	handle_errors {
		@502 expression {err.status_code} == 502
		handle @502 {
			wake_on_lan 88:88:88:88:87:88 # 192.168.178.24:9
			reverse_proxy 192.168.178.24:8081 {
				lb_try_duration 120s
			}
		}
	}
}

hrr.{{ domain_local }} {
	reverse_proxy 192.168.178.20:7575
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
}

has.{{ domain_local }} {
	reverse_proxy 192.168.178.20:8123
	tls {
		dns cloudflare {env.CLOUDFLARE_AUTH_TOKEN}
	}
}
